<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Dentical CRM</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* iPhone Safari uchun maxsus fix */
        html, body { 
            height: 100%; 
            overflow: hidden; 
            position: fixed; 
            width: 100%;
        }
        body { 
            background-color: #f8fafc; 
            font-family: -apple-system, system-ui, sans-serif;
        }
        .main-container {
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 90px;
        }
        .page { display: none; }
        .page.active { display: block; }
        
        /* Modal - klaviatura ochilganda o'zgarmasligi uchun */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 9999;
            justify-content: center;
            align-items: flex-start; /* Tepadan boshlanadi */
            padding-top: 40px;
        }
        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 24px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        input, select, textarea { font-size: 16px !important; width: 100%; border: 1px solid #e2e8f0; padding: 14px; border-radius: 14px; margin-bottom: 12px; background: #f1f5f9; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; padding: 15px; border-top: 1px solid #e2e8f0; z-index: 1000; }
        .nav-item { text-align: center; color: #94a3b8; flex: 1; }
        .nav-item.active { color: #2563eb; }
    </style>
</head>
<body>

    <div class="main-container">
        <div id="grafik" class="page active p-4">
            <h1 class="text-2xl font-bold mb-6">Grafik</h1>
            <div id="grafikList" class="space-y-3">
                <p class="text-center text-slate-400">Hozircha bo'sh</p>
            </div>
        </div>
        </div>

    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4">Yangi qabul</h2>
            <input type="text" id="patientName" placeholder="Bemor Ismi">
            <input type="time" id="startTime" value="09:00">
            <textarea id="note" placeholder="Eslatma"></textarea>
            <div class="flex space-x-3">
                <button onclick="closeModal()" class="flex-1 py-3">Yopish</button>
                <button onclick="saveAppointment()" class="flex-1 bg-blue-600 text-white rounded-xl font-bold">Saqlash</button>
            </div>
        </div>
    </div>

    <button onclick="openModal()" style="position:fixed; bottom:100px; right:20px;" class="bg-blue-600 text-white w-14 h-14 rounded-full shadow-xl">+</button>

    <nav class="bottom-nav">
        <div class="nav-item active"><i class="fas fa-calendar-alt"></i><p>Grafik</p></div>
        <div class="nav-item"><i class="fas fa-flask"></i><p>Lab</p></div>
        <div class="nav-item"><i class="fas fa-tooth"></i><p>Metod</p></div>
        <div class="nav-item"><i class="fas fa-wallet"></i><p>Kassa</p></div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        function openModal() { document.getElementById('appointmentModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('appointmentModal').style.display = 'none'; }

        // KLAVIATURA FIX: iPhone uchun ekranni joyida ushlash
        if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', () => {
                document.body.style.height = window.visualViewport.height + 'px';
            });
        }
        
        function saveAppointment() {
            const name = document.getElementById('patientName').value;
            if(!name) return;
            document.getElementById('grafikList').innerHTML += `<div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-blue-500 font-bold">${name}</div>`;
            closeModal();
            document.getElementById('patientName').value = '';
        }
    </script>
</body>
</html>
